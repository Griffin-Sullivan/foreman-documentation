<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Installing orcharhino Proxy</title>
<link rel="stylesheet" href="./orcharhino.css">
<!-- docinfo -->
</head>
<body class="book toc2 toc-left">
    <div id="wrap">
      <script src="/js/versions.js"></script>
      <script src="/js/nav.js"></script>
      <script>
        document.open();
        document.write(buildNavigation());
        addNavbarListeners();
        document.close();
      </script>
    </div>
<div id="header">
<h1>Installing orcharhino Proxy</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preparing-environment-for-capsule-installation">1. Preparing your Environment for Installation</a>
<ul class="sectlevel2">
<li><a href="#system-requirements_orcharhino Proxy">1.1. System Requirements</a></li>
<li><a href="#supported-operating-systems_orcharhino Proxy">1.2. Supported Operating Systems</a></li>
<li><a href="#capsule-ports-and-firewalls-requirements_orcharhino Proxy">1.3. Ports and Firewalls Requirements</a></li>
<li><a href="#enabling-connections-from-capsule-to-satellite_orcharhino Proxy">1.4. Enabling Connections from orcharhino Proxy to orcharhino server</a></li>
<li><a href="#enabling-connections-to-capsule_orcharhino Proxy">1.5. Enabling Connections from orcharhino server and Clients to a orcharhino Proxy</a></li>
<li><a href="#verifying-firewall-settings_orcharhino Proxy">1.6. Verifying Firewall Settings</a></li>
</ul>
</li>
<li><a href="#installing-capsule-server">2. Installing orcharhino Proxy</a>
<ul class="sectlevel2">
<li><a href="#registering-to-satellite-server_orcharhino Proxy">2.1. Registering to orcharhino server</a></li>
<li><a href="#attaching-satellite-infrastructure-subscription_orcharhino Proxy">2.2. Attaching the orcharhino Infrastructure Subscription</a></li>
<li><a href="#configuring-repositories-proxy_orcharhino Proxy">2.3. Configuring Repositories</a></li>
<li><a href="#installing-capsule-server-packages_orcharhino Proxy">2.4. Installing orcharhino Proxy Packages</a></li>
<li><a href="#installing-an-external-smart-proxy-upstream_orcharhino Proxy">2.5. Installing orcharhino Proxy</a></li>
<li><a href="#synchronizing-the-system-clock-with-chronyd_orcharhino Proxy">2.6. Synchronizing the System Clock With chronyd</a></li>
<li><a href="#assigning-organization-location-capsule-server_orcharhino Proxy">2.7. Assigning the Correct Organization and Location to orcharhino Proxy in the orcharhino web UI</a></li>
<li><a href="#configuring-capsule-server-with-ssl-certificates">2.8. Configuring orcharhino Proxy with SSL Certificates</a></li>
</ul>
</li>
<li><a href="#performing-additional-configuration-on-capsule-server">3. Performing Additional Configuration on orcharhino Proxy</a>
<ul class="sectlevel2">
<li><a href="#enabling-openscap_orcharhino Proxy">3.1. Enabling OpenSCAP on External orcharhino Proxies</a></li>
<li><a href="#enabling-power-management-on-managed-hosts_orcharhino Proxy">3.2. Enabling Power Management on Managed Hosts</a></li>
<li><a href="#configuring-dns-dhcp-and-tftp_orcharhino Proxy">3.3. Configuring DNS, DHCP, and TFTP on orcharhino Proxy</a></li>
</ul>
</li>
<li><a href="#configuring-external-services">4. Configuring orcharhino Proxy with External Services</a>
<ul class="sectlevel2">
<li><a href="#configuring-external-dns_orcharhino Proxy">4.1. Configuring orcharhino Proxy with External DNS</a></li>
<li><a href="#configuring-external-dhcp_orcharhino Proxy">4.2. Configuring orcharhino Proxy with External DHCP</a></li>
<li><a href="#configuring-external-tftp_orcharhino Proxy">4.3. Configuring orcharhino Proxy with External TFTP</a></li>
<li><a href="#configuring-external-idm-dns_orcharhino Proxy">4.4. Configuring orcharhino Proxy with External IdM DNS</a></li>
</ul>
</li>
<li><a href="#capsule-server-scalability-considerations_orcharhino Proxy">Appendix A: orcharhino Proxy Scalability Considerations</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preparing-environment-for-capsule-installation">1. Preparing your Environment for Installation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="system-requirements_orcharhino Proxy">1.1. System Requirements</h3>
<div class="paragraph">
<p>The following requirements apply to the networked base operating system:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>x86_64 architecture</p>
</li>
<li>
<p>4-core 2.0 GHz CPU at a minimum</p>
</li>
<li>
<p>Administrative user (root) access</p>
</li>
<li>
<p>A system umask of 0022</p>
</li>
<li>
<p>Full forward and reverse DNS resolution using a fully-qualified domain name</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Before you install orcharhino Proxy, ensure that your environment meets the requirements for installation.</p>
</div>
<div class="paragraph">
<p>orcharhino Proxy must be installed on a freshly provisioned system that serves no other function except to run orcharhino Proxy.
The freshly provisioned system must not have the following users provided by external identity providers to avoid conflicts with the local users that orcharhino Proxy creates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>apache</p>
</li>
<li>
<p>foreman</p>
</li>
<li>
<p>foreman-proxy</p>
</li>
<li>
<p>postgres</p>
</li>
<li>
<p>puppet</p>
</li>
<li>
<p>puppetserver</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="supported-operating-systems_orcharhino Proxy">1.2. Supported Operating Systems</h3>
<div class="paragraph">
<p>The following operating systems are supported by the installer, have packages, and are tested for deploying orcharhino:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Operating Systems supported by foreman-installer</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Operating System</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Notes</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Before you install orcharhino, apply all operating system updates if possible.</p>
</div>
<div class="paragraph">
<p>Install orcharhino Proxy on a freshly provisioned system.</p>
</div>
</div>
<div class="sect2">
<h3 id="capsule-ports-and-firewalls-requirements_orcharhino Proxy">1.3. Ports and Firewalls Requirements</h3>
<div class="paragraph">
<p>For the components of orcharhino architecture to communicate, ensure that the required network ports are open and free on the base operating system.
You must also ensure that the required network ports are open on any network-based firewalls.</p>
</div>
<div class="paragraph">
<p>The installation of a orcharhino Proxy fails if the ports between orcharhino server and orcharhino Proxy are not open before installation starts.</p>
</div>
<div class="paragraph">
<p>Use this information to configure any network-based firewalls.
Note that some cloud solutions must be specifically configured to allow communications between machines because they isolate machines similarly to network-based firewalls.
If you use an application-based firewall, ensure that the application-based firewall permits all applications that are listed in the tables and known to your firewall.
If possible, disable the application checking and allow open port communication based on the protocol.</p>
</div>
<div class="paragraph">
<div class="title">Integrated orcharhino Proxy</div>
<p>orcharhino server has an integrated orcharhino Proxy and any host that is directly connected to orcharhino server is a Client of orcharhino in the context of this section.
This includes the base operating system on which orcharhino Proxy is running.</p>
</div>
<div class="paragraph">
<div class="title">Clients of orcharhino Proxy</div>
<p>Hosts which are clients of orcharhino Proxies, other than orcharhino&#8217;s integrated orcharhino Proxy, do not need access to orcharhino server.
For more information on orcharhino Topology, see <a href="sources/installation_and_maintenance.html#sect-Documentation-Architecture_Guide-Capsule_Networking">orcharhino Proxy Networking</a> in <em>Planning for orcharhino</em>.</p>
</div>
<div class="paragraph">
<p>Required ports can change based on your configuration.</p>
</div>
<div class="paragraph">
<p>A matrix table of ports is available in the Red&#160;Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/5627751">Red Hat Satellite List of Network Ports</a>.</p>
</div>
<div class="paragraph">
<p>The following tables indicate the destination port and the direction of network traffic:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Ports for orcharhino Proxy to orcharhino Communication</caption>
<colgroup>
<col style="width: 24%;">
<col style="width: 20%;">
<col style="width: 18%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Required For</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5646</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">amqp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">orcharhino Proxy&#8217;s Qpid dispatch router to Qpid dispatch router in orcharhino</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Ports for Client to orcharhino Proxy Communication</caption>
<colgroup>
<col style="width: 24%;">
<col style="width: 20%;">
<col style="width: 18%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">8140</th>
<th class="tableblock halign-left valign-top">TCP</th>
<th class="tableblock halign-left valign-top">HTTPS</th>
<th class="tableblock halign-left valign-top">Puppet agent to Puppet master connections</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subscription Management Services and Telemetry Services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9090</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sending SCAP reports to the orcharhino Proxy and for the discovery image during provisioning</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DNS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client DNS queries to a orcharhino Proxy&#8217;s DNS service (Optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Client to orcharhino Proxy broadcasts, DHCP broadcasts for Client provisioning from a orcharhino Proxy (Optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TFTP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Clients downloading PXE boot image files from a orcharhino Proxy for provisioning (Optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5000</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Connection to Katello for the Docker registry (Optional)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Ports for orcharhino Proxy to Client Communication</caption>
<colgroup>
<col style="width: 24%;">
<col style="width: 20%;">
<col style="width: 18%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Required For</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP and UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ICMP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>DHCP orcharhino Proxy to Client network, ICMP ECHO to verify IP address is free (Optional)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>orcharhino Proxy to Client broadcasts, DHCP broadcasts for Client provisioning from a orcharhino Proxy (Optional)</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8443</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HTTP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>orcharhino Proxy to Client "reboot" command to a discovered host during provisioning (Optional)</p>
</div></div></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Any managed host that is directly connected to orcharhino server is a client in this context because it is a client of the integrated orcharhino Proxy.
This includes the base operating system on which a orcharhino Proxy is running.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Optional Network Ports</caption>
<colgroup>
<col style="width: 24%;">
<col style="width: 20%;">
<col style="width: 18%;">
<col style="width: 38%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Port</th>
<th class="tableblock halign-left valign-top">Protocol</th>
<th class="tableblock halign-left valign-top">Service</th>
<th class="tableblock halign-left valign-top">Required For</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>orcharhino and orcharhino Proxy originated communications, for Remote Execution (Rex) and Ansible.</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7911</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TCP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DHCP</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="ulist">
<ul>
<li>
<p>orcharhino Proxy originated commands for orchestration of DHCP records (local or external).</p>
</li>
<li>
<p>If DHCP is provided by an external service, you must open the port on the external server.</p>
</li>
</ul>
</div></div></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
A DHCP orcharhino Proxy sends an ICMP ECHO to confirm an IP address is free, <strong>no response</strong> of any kind is expected.
ICMP can be dropped by a networked-based firewall, but <strong>any</strong> response prevents the allocation of IP addresses.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="enabling-connections-from-capsule-to-satellite_orcharhino Proxy">1.4. Enabling Connections from orcharhino Proxy to orcharhino server</h3>
<div class="paragraph">
<p>On orcharhino server, you must enable the incoming connection from orcharhino Proxy to orcharhino server and make this rule persistent across reboots.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Ensure that the firewall rules on orcharhino server are configured to enable connections for client to orcharhino communication, because orcharhino Proxy is a client of orcharhino server.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_installation_guide.html#enabling-client-connections-to-satellite_orcharhino">Enabling Connections from a Client to orcharhino server</a> in <em>Installing orcharhino</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino server, enter the following command to open the port for orcharhino Proxy to orcharhino communication:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port="5646/tcp"</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="enabling-connections-to-capsule_orcharhino Proxy">1.5. Enabling Connections from orcharhino server and Clients to a orcharhino Proxy</h3>
<div class="paragraph">
<p>On the base operating system on which you want to install orcharhino Proxy, you must enable incoming connections from orcharhino server and clients to orcharhino Proxy and make these rules persistent across reboots.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On the base operating system on which you want to install orcharhino Proxy, enter the following command to open the ports for orcharhino server and clients communication to orcharhino Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port="53/udp" --add-port="53/tcp" \
--add-port="67/udp" --add-port="69/udp" \
--add-port="80/tcp" --add-port="443/tcp" \
--add-port="5000/tcp" --add-port="5647/tcp" \
--add-port="8000/tcp" --add-port="8140/tcp" \
--add-port="8443/tcp" --add-port="9090/tcp"</pre>
</div>
</div>
</li>
<li>
<p>Make the changes persistent:</p>
<div class="listingblock">
<div class="content">
<pre># firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="verifying-firewall-settings_orcharhino Proxy">1.6. Verifying Firewall Settings</h3>
<div class="paragraph">
<p>Use this procedure to verify your changes to the firewall settings.</p>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --list-all</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/security_guide/sec-using_firewalls#sec-Getting_started_with_firewalld">Getting Started with firewalld</a> in the <em>Red Hat Enterprise Linux 7 Security Guide</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-capsule-server">2. Installing orcharhino Proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before you install orcharhino Proxy, you must ensure that your environment meets the requirements for installation.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_proxy_installation_guide.html#preparing-environment-for-capsule-installation">Preparing your Environment for Installation</a>.</p>
</div>
<div class="sect2">
<h3 id="registering-to-satellite-server_orcharhino Proxy">2.1. Registering to orcharhino server</h3>
<div class="paragraph">
<p>Use this procedure to register the base operating system on which you want to install orcharhino Proxy to orcharhino server.</p>
</div>
<div class="ulist">
<div class="title">Subscription Manifest Prerequisites</div>
<ul>
<li>
<p>On orcharhino server, a manifest must be installed and it must contain the appropriate repositories for the organization you want orcharhino Proxy to belong to.</p>
</li>
<li>
<p>The manifest must contain repositories for the base operating system on which you want to install orcharhino Proxy, as well as any clients that you want to connect to orcharhino Proxy.</p>
</li>
<li>
<p>The repositories must be synchronized.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information on manifests and repositories, see <a href="sources/usage_guides/content_management_guide.html#Managing_Subscriptions/">Managing Subscriptions</a> in the <em>orcharhino Content Management Guide</em>.</p>
</div>
<div class="ulist">
<div class="title">Proxy and Network Prerequisites</div>
<ul>
<li>
<p>orcharhino server base operating system must be able to resolve the host name of the orcharhino Proxy base operating system and vice versa.</p>
</li>
<li>
<p>The base operating system on which you want to install orcharhino Proxy must not be configured to use a proxy to connect to the Red Hat CDN.</p>
</li>
<li>
<p>You must configure the host and network-based firewalls accordingly.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_proxy_installation_guide.html#capsule-ports-and-firewalls-requirements_orcharhino Proxy">Ports and Firewalls Requirements</a>.</p>
</li>
<li>
<p>You must have a orcharhino server user name and password.
For more information, see <a href="sources/management_ui/the_administer_menu.html#chap-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_Authentication">Configuring External Authentication</a> in <em>Administering orcharhino</em>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Download the <code>katello-ca-consumer-latest.noarch.rpm</code> package on the base operating system on which you want to install orcharhino Proxy.
The consumer RPM configures the host to download content from the content source that is specified in orcharhino.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># curl --insecure --output katello-ca-consumer-latest.noarch.rpm https://<em>orcharhino.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>katello-ca-consumer-latest.noarch.rpm</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
<li>
<p>Register the orcharhino Proxy base operating system with the environments that you want orcharhino Proxy to belong to.
Use an activation key to simplify specifying the environments.
For more information about activation keys, see <a href="sources/usage_guides/content_management_guide.html#Managing_Activation_Keys">Managing Activation Keys</a> in the <em>Content Management Guide</em>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager register --org=<em>organization_name</em> --activationkey=<em>example_activation_key</em></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="attaching-satellite-infrastructure-subscription_orcharhino Proxy">2.2. Attaching the orcharhino Infrastructure Subscription</h3>
<div class="paragraph">
<p>After you have registered orcharhino Proxy, you must identify your subscription Pool ID and attach an available subscription.
The orcharhino Infrastructure subscription provides access to the orcharhino, Red&#160;Hat Enterprise Linux, and Red&#160;Hat Software Collections (RHSCL) content.
This is the only subscription required.</p>
</div>
<div class="paragraph">
<p>orcharhino Infrastructure is included with all subscriptions that include Smart Management.
For more information, see the Red&#160;Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/3382781">orcharhino Infrastructure Subscriptions MCT3718 MCT3719</a>.</p>
</div>
<div class="paragraph">
<p>Subscriptions are classified as available if they are not already attached to a system.
If you are unable to find an available orcharhino subscription, see the Red&#160;Hat Knowledgebase solution <a href="https://access.redhat.com/solutions/2058823">How do I figure out which subscriptions have been consumed by clients registered under Red Hat Subscription Manager?</a> to run a script to see if your subscription is being consumed by another system.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Identify the Pool ID of the orcharhino Infrastructure subscription:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager list --all --available --matches 'Red Hat Satellite Infrastructure Subscription'</pre>
</div>
</div>
<div class="paragraph">
<p>The command displays output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Subscription Name:   Red Hat Satellite Infrastructure Subscription
Provides:            Red Hat Satellite
                      Red Hat Software Collections (for RHEL Server)
                      Red Hat CodeReady Linux Builder for x86_64
                      Red Hat Ansible Engine
                      Red Hat Enterprise Linux Load Balancer (for RHEL Server)
                      Red Hat
                      Red Hat Software Collections (for RHEL Server)
                      Red Hat Enterprise Linux Server
                      Red Hat Satellite Capsule
                      Red Hat Enterprise Linux for x86_64
                      Red Hat Enterprise Linux High Availability for x86_64
                      Red Hat Satellite
                      Red Hat Satellite 5 Managed DB
                      Red Hat Satellite 6
                      Red Hat Discovery
SKU:                 MCT3719
Contract:            11878983
Pool ID:             8a85f99968b92c3701694ee998cf03b8
Provides Management: No
Available:           1
Suggested:           1
Service Level:       Premium
Service Type:        L1-L3
Subscription Type:   Standard
Ends:                03/04/2020
System Type:         Physical</pre>
</div>
</div>
</li>
<li>
<p>Make a note of the subscription Pool ID.
Your subscription Pool ID is different from the example provided.</p>
</li>
<li>
<p>Attach the orcharhino Infrastructure subscription to the base operating system that your orcharhino Proxy is running on:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager attach --pool=<em>pool_id</em></pre>
</div>
</div>
<div class="paragraph">
<p>The command displays output similar to the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">Successfully attached a subscription for: Red Hat Satellite Infrastructure Subscription</pre>
</div>
</div>
</li>
<li>
<p>Optional: Verify that the orcharhino Infrastructure subscription is attached:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager list --consumed</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-repositories-proxy_orcharhino Proxy">2.3. Configuring Repositories</h3>
<div class="paragraph">
<p>Use this procedure to enable the repositories that are required to install orcharhino Proxy.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Disable all repositories:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># subscription-manager repos --disable "*"</pre>
</div>
</div>
</li>
<li>
<p>Enable the following repositories:</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you are installing orcharhino Proxy as a virtual machine hosted on oVirt, you must also enable the <strong>Red&#160;Hat Common</strong> repository, and install oVirt guest agents and drivers.
For more information, see <a href="https://access.redhat.com/documentation/en-us/red_hat_virtualization/4.3/html/virtual_machine_management_guide/installing_guest_agents_and_drivers_linux#Installing_the_Guest_Agents_and_Drivers_on_Red_Hat_Enterprise_Linux">Installing the Guest Agents and Drivers on Red Hat Enterprise Linux</a> in the <em>Virtual Machine Management Guide</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+
. Clear any metadata:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum clean all</pre>
</div>
</div>
<div class="paragraph">
<p>+
. Optional: Verify that the required repositories are enabled:</p>
</div>
<div class="paragraph">
<p>+</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum repolist enabled</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="installing-capsule-server-packages_orcharhino Proxy">2.4. Installing orcharhino Proxy Packages</h3>
<div class="paragraph">
<p>Before installing orcharhino Proxy packages, you must update all packages that are installed on the base operating system.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To install orcharhino Proxy, complete the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Update all packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum update</pre>
</div>
</div>
</li>
<li>
<p>Install the <code>foreman-proxy-content</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install foreman-proxy-content</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="installing-an-external-smart-proxy-upstream_orcharhino Proxy">2.5. Installing orcharhino Proxy</h3>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To install an external orcharhino Proxy, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer \
  --no-enable-foreman \
  --no-enable-foreman-cli \
  --enable-puppet \
  --puppet-server-ca=false \
  --puppet-server-foreman-url=https://<em>orcharhino.example.com</em> \
  --enable-foreman-proxy \
  --foreman-proxy-puppetca=false \
  --foreman-proxy-tftp=false \
  --foreman-proxy-foreman-base-url=https://<em>orcharhino.example.com</em> \
  --foreman-proxy-trusted-hosts=<em>orcharhino.example.com</em> \
  --foreman-proxy-oauth-consumer-key=<em>oAuth_Consumer_Key</em> \
  --foreman-proxy-oauth-consumer-secret=<em>oAuth_Consumer_Secret</em></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="synchronizing-the-system-clock-with-chronyd_orcharhino Proxy">2.6. Synchronizing the System Clock With chronyd</h3>
<div class="paragraph">
<p>To minimize the effects of time drift, you must synchronize the system clock on the base operating system on which you want to install orcharhino Proxy with Network Time Protocol (NTP) servers.
If the base operating system clock is configured incorrectly, certificate verification might fail.</p>
</div>
<div class="paragraph">
<p>For more information about the <code>chrony</code> suite, see <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/ch-configuring_ntp_using_the_chrony_suite">Configuring NTP Using the chrony Suite</a> in the <em>Red Hat Enterprise Linux 7 System Administrator&#8217;s Guide</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>chrony</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install chrony</pre>
</div>
</div>
</li>
<li>
<p>Start and enable the <code>chronyd</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start chronyd
# systemctl enable chronyd</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="assigning-organization-location-capsule-server_orcharhino Proxy">2.7. Assigning the Correct Organization and Location to orcharhino Proxy in the orcharhino web UI</h3>
<div class="paragraph">
<p>After installing orcharhino Proxy packages, if there is more than one organization or location, you must assign the correct organization and location to orcharhino Proxy to make orcharhino Proxy visible in the orcharhino web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Log into the orcharhino web UI.</p>
</li>
<li>
<p>From the <strong>Organization</strong> list in the upper-left of the screen, select <strong>Any Organization</strong>.</p>
</li>
<li>
<p>From the <strong>Location</strong> list in the upper-left of the screen, select <strong>Any Location</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong> and select orcharhino Proxy.</p>
</li>
<li>
<p>From the <strong>Select Actions</strong> list, select <strong>Assign Organization</strong>.</p>
</li>
<li>
<p>From the <strong>Organization</strong> list, select the organization where you want to assign this orcharhino Proxy.</p>
</li>
<li>
<p>Click <strong>Fix Organization on Mismatch</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Select orcharhino Proxy. From the <strong>Select Actions</strong> list, select <strong>Assign Location</strong>.</p>
</li>
<li>
<p>From the <strong>Location</strong> list, select the location where you want to assign this orcharhino Proxy.</p>
</li>
<li>
<p>Click <strong>Fix Location on Mismatch</strong>.</p>
</li>
<li>
<p>Click <strong>Submit</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Organizations</strong> and click the organization to which you have assigned orcharhino Proxy.</p>
</li>
<li>
<p>Click <strong>orcharhino Proxies</strong> tab and ensure that orcharhino Proxy is listed under the <strong>Selected items</strong> list, then click <strong>Submit</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Administer</strong> &gt; <strong>Locations</strong> and click the location to which you have assigned orcharhino Proxy.</p>
</li>
<li>
<p>Click <strong>orcharhino Proxies</strong> tab and ensure that orcharhino Proxy is listed under the <strong>Selected items</strong> list, then click <strong>Submit</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>Optionally, you can verify if orcharhino Proxy is correctly listed in the orcharhino web UI.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Select the organization from the <strong>Organization</strong> list.</p>
</li>
<li>
<p>Select the location from the <strong>Location</strong> list.</p>
</li>
<li>
<p>Navigate to <strong>Hosts</strong> &gt; <strong>All Hosts</strong>.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino Proxies</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-capsule-server-with-ssl-certificates">2.8. Configuring orcharhino Proxy with SSL Certificates</h3>
<div class="paragraph">
<p>orcharhino uses SSL certificates to enable encrypted communications between orcharhino server, external orcharhino Proxys, and all hosts.
Depending on the requirements of your organization, you must configure your orcharhino Proxy with a default or custom certificate.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you use a default SSL certificate, you must also configure each external orcharhino Proxy with a distinct default SSL certificate.
For more information, see <a href="#configuring-capsule-default-certificate_orcharhino Proxy">Configuring orcharhino Proxy with a Default SSL Certificate</a>.</p>
</li>
<li>
<p>If you use a custom SSL certificate, you must also configure each external orcharhino Proxy with a distinct custom SSL certificate.
For more information, see <a href="#configuring-capsule-custom-server-certificate_orcharhino Proxy">Configuring orcharhino Proxy with a Custom SSL Certificate</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="configuring-capsule-default-certificate_orcharhino Proxy">2.8.1. Configuring orcharhino Proxy with a Default SSL Certificate</h4>
<div class="paragraph">
<p>Use this section to configure orcharhino Proxy with an SSL certificate that is signed by orcharhino server default Certificate Authority (CA).</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>orcharhino Proxy is registered to orcharhino server.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_proxy_installation_guide.html#registering-to-satellite-server_orcharhino Proxy">Registering to orcharhino server</a>.</p>
</li>
<li>
<p>orcharhino Proxy packages are installed.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_proxy_installation_guide.html#installing-capsule-server-packages_orcharhino Proxy">Installing orcharhino Proxy Packages</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino server, to store all the source certificate files for your orcharhino Proxy, create a directory that is accessible only to the <code>root</code> user, for example <code>/root/orcharhino Proxy_cert</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/<em>orcharhino Proxy_cert</em></pre>
</div>
</div>
</li>
<li>
<p>On orcharhino server, generate the <code><em>/root/orcharhino Proxy_cert/orcharhino Proxy_certs.tar</em></code> certificate archive for your orcharhino Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-proxy-certs-generate \
--foreman-proxy-fqdn <em>orcharhino-proxy.example.com</em> \
--certs-tar <em>/root/orcharhino Proxy_cert/orcharhino Proxy_certs.tar</em></pre>
</div>
</div>
<div class="paragraph">
<p>Retain a copy of the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns for deploying the certificate to your orcharhino Proxy.</p>
</div>
<div class="listingblock">
<div class="title">Example output of <code>foreman-proxy-certs-generate</code></div>
<div class="content">
<pre class="nowrap"><em>output omitted</em>
foreman-installer \
--scenario foreman-proxy-content \
--certs-tar-file                              "<em>/root/orcharhino Proxy_certs.tar</em>"\
--foreman-proxy-content-parent-fqdn           "<em>orcharhino.example.com</em>"\
--foreman-proxy-register-in-foreman           "true"\
--foreman-proxy-foreman-base-url              "https://<em>orcharhino.example.com</em>"\
--foreman-proxy-trusted-hosts                 "<em>orcharhino.example.com</em>"\
--foreman-proxy-trusted-hosts                 "<em>orcharhino-proxy.example.com</em>"\
--foreman-proxy-oauth-consumer-key            "<em>s97QxvUAgFNAQZNGg4F9zLq2biDsxM7f</em>"\
--foreman-proxy-oauth-consumer-secret         "<em>6bpzAdMpRAfYaVZtaepYetomgBVQ6ehY</em>"\
--puppet-server-foreman-url                   "https://<em>orcharhino.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino server, copy the certificate archive file to your orcharhino Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/orcharhino Proxy_cert/<em>orcharhino-proxy.example.com</em>-certs.tar \
root@<em>orcharhino-proxy.example.com</em>:/root/<em>orcharhino-proxy.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino Proxy, to deploy the certificate, enter the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns.</p>
<div class="paragraph">
<p>When network connections or ports to orcharhino are not yet open, you can set the <code>--foreman-proxy-register-in-foreman</code> option to <code>false</code> to prevent orcharhino Proxy from attempting to connect to orcharhino and reporting errors.
Run the installer again with this option set to <code>true</code> when the network and firewalls are correctly configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not delete the certificate archive file after you deploy the certificate.
It is required, for example, when upgrading orcharhino Proxy.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-capsule-custom-server-certificate_orcharhino Proxy">2.8.2. Configuring orcharhino Proxy with a Custom SSL Certificate</h4>
<div class="paragraph">
<p>If you configure orcharhino server to use a custom SSL certificate, you must also configure each of your external orcharhino Proxys with a distinct custom SSL certificate.</p>
</div>
<div class="paragraph">
<p>To configure your orcharhino Proxy with a custom certificate, complete the following procedures on each orcharhino Proxy:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#creating-a-custom-certificate_orcharhino Proxy">Creating a Custom SSL Certificate for orcharhino Proxy</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-capsule-server_orcharhino Proxy">Deploying a Custom SSL Certificate to orcharhino Proxy</a></p>
</li>
<li>
<p><a href="#deploying-a-custom-ssl-certificate-to-hosts_orcharhino Proxy">Deploying a Custom SSL Certificate to Hosts</a></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="creating-a-custom-certificate_orcharhino Proxy">Creating a Custom SSL Certificate for orcharhino Proxy</h5>
<div class="paragraph">
<p>On orcharhino server, create a custom certificate for your orcharhino Proxy.
If you already have a custom SSL certificate for orcharhino Proxy, skip this procedure.</p>
</div>
<div class="paragraph">
<p>When you configure orcharhino Proxy with custom certificates, note the following considerations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You must use the Privacy-Enhanced Mail (PEM) encoding for the SSL certificates.</p>
</li>
<li>
<p>You cannot use the same certificate for both orcharhino server and orcharhino Proxy.</p>
</li>
<li>
<p>The same Certificate Authority must sign certificates for orcharhino server and orcharhino Proxy.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>To store all the source certificate files, create a directory that is accessible only to the <code>root</code> user.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir /root/orcharhino Proxy_cert</pre>
</div>
</div>
</li>
<li>
<p>Create a private key with which to sign the Certificate Signing Request (CSR).</p>
<div class="paragraph">
<p>Note that the private key must be unencrypted.
If you use a password-protected private key, remove the private key password.</p>
</div>
<div class="paragraph">
<p>If you already have a private key for this orcharhino Proxy, skip this step.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl genrsa -out <code>/root/orcharhino Proxy_cert/orcharhino Proxy_cert_key.pem</code> 4096</pre>
</div>
</div>
</li>
<li>
<p>Create the <code>/root/orcharhino Proxy_cert/openssl.cnf</code> configuration file for the Certificate Signing Request (CSR) and include the following content:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">[ req ]
req_extensions = v3_req
distinguished_name = req_distinguished_name
x509_extensions = usr_cert
prompt = no

[ req_distinguished_name ] <b class="conum">(1)</b>
C  = <em>Country Name (2 letter code)</em>
ST = <em>State or Province Name (full name)</em>
L  = <em>Locality Name (eg, city)</em>
O  = <em>Organization Name (eg, company)</em>
OU = <em>The division of your organization handling the certificate</em>
CN = <em>orcharhino Proxy.example.com</em> <b class="conum">(2)</b>

[ v3_req ]
basicConstraints = CA:FALSE
keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment
extendedKeyUsage = serverAuth, clientAuth, codeSigning, emailProtection
subjectAltName = @alt_names

[ usr_cert ]
basicConstraints=CA:FALSE
nsCertType = client, server, email
keyUsage = nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage = serverAuth, clientAuth, codeSigning, emailProtection
nsComment = "OpenSSL Generated Certificate"
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid,issuer

[ alt_names ]
DNS.1 = <em>orcharhino Proxy.example.com</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In the <code>[ req_distinguished_name ]</code> section, enter information about your organization.</p>
</li>
<li>
<p>Set the certificate&#8217;s Common Name <code>CN</code> to match the fully qualified domain name (FQDN) of your orcharhino Proxy or a wildcard value <code>*</code>.
To confirm a FQDN, on that orcharhino Proxy, enter the <code>hostname -f</code> command.
This is required to ensure that the <code>katello-certs-check</code> command validates the certificate correctly.
If you set a wildcard value, you must add the <code>-t foreman-proxy</code> option when you use the <code>katello-certs-check</code> command.</p>
</li>
<li>
<p>Set the Subject Alternative Name (SAN) <code>DNS.1</code> to match the fully qualified domain name (FQDN) of your server.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Generate the Certificate Signing Request (CSR):</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># openssl req -new \
-key <em>/root/orcharhino Proxy_cert/orcharhino Proxy_cert_key.pem</em> \ <b class="conum">(1)</b>
-config <em>/root/orcharhino Proxy_cert/openssl.cnf</em> \ <b class="conum">(2)</b>
-out <em>/root/orcharhino Proxy_cert/orcharhino Proxy_cert_csr.pem</em> <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to the private key.</p>
</li>
<li>
<p>Path to the configuration file.</p>
</li>
<li>
<p>Path to the CSR to generate.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Send the certificate signing request to the Certificate Authority.
The same Certificate Authority must sign certificates for orcharhino server and orcharhino Proxy.</p>
<div class="paragraph">
<p>When you submit the request, specify the lifespan of the certificate.
The method for sending the certificate request varies, so consult the Certificate Authority for the preferred method.
In response to the request, you can expect to receive a Certificate Authority bundle and a signed certificate, in separate files.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploying-a-custom-ssl-certificate-to-capsule-server_orcharhino Proxy">Deploying a Custom SSL Certificate to orcharhino Proxy</h5>
<div class="paragraph">
<p>Use this procedure to configure your orcharhino Proxy with a custom SSL certificate signed by a Certificate Authority.
The <code>foreman-installer</code> command, which the <code>foreman-proxy-certs-generate</code> command returns, is unique to each orcharhino Proxy.
Do not use the same command on more than one orcharhino Proxy.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>orcharhino server is configured with a custom certificate.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_installation_guide.html#configuring-satellite-custom-server-certificate_orcharhino">Configuring orcharhino server with a Custom SSL Certificate</a> in <em>Installing orcharhino</em>.</p>
</li>
<li>
<p>orcharhino Proxy is registered to orcharhino server.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_proxy_installation_guide.html#registering-to-satellite-server_orcharhino Proxy">Registering to orcharhino server</a>.</p>
</li>
<li>
<p>orcharhino Proxy packages are installed.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_proxy_installation_guide.html#installing-capsule-server-packages_orcharhino Proxy">Installing orcharhino Proxy Packages</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On orcharhino server, validate the custom SSL certificate input files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># katello-certs-check \
-c <em>/root/orcharhino Proxy_cert/orcharhino Proxy_cert.pem</em> \      <b class="conum">(1)</b>
-k <em>/root/orcharhino Proxy_cert/orcharhino Proxy_cert_key.pem</em> \  <b class="conum">(2)</b>
-b <em>/root/orcharhino Proxy_cert/ca_cert_bundle.pem</em>      <b class="conum">(3)</b></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Path to orcharhino Proxy certificate file that is signed by a Certificate Authority.</p>
</li>
<li>
<p>Path to the private key that was used to sign orcharhino Proxy certificate.</p>
</li>
<li>
<p>Path to the Certificate Authority bundle.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you set a wildcard value <code>*</code> for the certificate&#8217;s Common Name <code>CN =</code> in the <code>/root/orcharhino Proxy_cert/openssl.cnf</code> configuration file, you must add the <code>-t foreman-proxy</code> option to the <code>katello-certs-check</code> command.</p>
</div>
<div class="paragraph">
<p>If the command is successful, it returns two <code>foreman-proxy-certs-generate</code> commands, one of which you must use to generate the certificate archive file for your orcharhino Proxy.</p>
</div>
<div class="listingblock">
<div class="title">Example output of <code>katello-certs-check</code></div>
<div class="content">
<pre class="nowrap">Validation succeeded.

To use them inside a NEW $FOREMAN_PROXY, run this command:
  foreman-proxy-certs-generate --foreman-proxy-fqdn "$FOREMAN_PROXY" \
    --certs-tar  "~$FOREMAN_PROXY-certs.tar" \
    --server-cert "<em>/root/orcharhino Proxy_cert/orcharhino Proxy_cert.pem</em>" \
    --server-key "<em>/root/orcharhino Proxy_cert/orcharhino Proxy_cert_key.pem</em>" \
    --server-ca-cert "<em>/root/orcharhino Proxy_cert/ca_cert_bundle.pem</em>" \

To use them inside an EXISTING $FOREMAN_PROXY, run this command INSTEAD:
  foreman-proxy-certs-generate --foreman-proxy-fqdn "\$FOREMAN_PROXY" \
    --certs-tar  "~/$FOREMAN_PROXY-certs.tar" \
    --server-cert "<em>/root/orcharhino Proxy_cert/orcharhino Proxy_cert.pem</em>" \
    --server-key "<em>/root/orcharhino Proxy_cert/orcharhino Proxy_cert_key.pem</em>" \
    --server-ca-cert "<em>/root/orcharhino Proxy_cert/ca_cert_bundle.pem</em>" \
    --certs-update-server</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino server, from the output of the <code>katello-certs-check</code> command, depending on your requirements, enter the <code>foreman-proxy-certs-generate</code> command that generates a certificate for a new or existing orcharhino Proxy.</p>
<div class="paragraph">
<p>In this command, change <code>$FOREMAN_PROXY</code> to the FQDN of your orcharhino Proxy.</p>
</div>
</li>
<li>
<p>Retain a copy of the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns for deploying the certificate to your orcharhino Proxy.</p>
<div class="listingblock">
<div class="title">Example output of <code>foreman-proxy-certs-generate</code></div>
<div class="content">
<pre class="nowrap"><em>output omitted</em>
foreman-installer \
--scenario foreman-proxy-content \
--certs-tar-file                              "<em>/root/orcharhino Proxy_certs.tar</em>"\
--foreman-proxy-content-parent-fqdn           "<em>orcharhino.example.com</em>"\
--foreman-proxy-register-in-foreman           "true"\
--foreman-proxy-foreman-base-url              "https://<em>orcharhino.example.com</em>"\
--foreman-proxy-trusted-hosts                 "<em>orcharhino.example.com</em>"\
--foreman-proxy-trusted-hosts                 "<em>orcharhino-proxy.example.com</em>"\
--foreman-proxy-oauth-consumer-key            "<em>s97QxvUAgFNAQZNGg4F9zLq2biDsxM7f</em>"\
--foreman-proxy-oauth-consumer-secret         "<em>6bpzAdMpRAfYaVZtaepYetomgBVQ6ehY</em>"\
--puppet-server-foreman-url                   "https://<em>orcharhino.example.com</em>"</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino server, copy the certificate archive file to your orcharhino Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /root/orcharhino Proxy_cert/<em>orcharhino-proxy.example.com</em>-certs.tar \
root@<em>orcharhino-proxy.example.com</em>:/root/<em>orcharhino-proxy.example.com</em>-certs.tar</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino Proxy, to deploy the certificate, enter the <code>foreman-installer</code> command that the <code>foreman-proxy-certs-generate</code> command returns.</p>
<div class="paragraph">
<p>When network connections or ports to orcharhino are not yet open, you can set the <code>--foreman-proxy-register-in-foreman</code> option to <code>false</code> to prevent orcharhino Proxy from attempting to connect to orcharhino and reporting errors.
Run the installer again with this option set to <code>true</code> when the network and firewalls are correctly configured.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Do not delete the certificate archive file after you deploy the certificate.
It is required, for example, when upgrading orcharhino Proxy.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="deploying-a-custom-ssl-certificate-to-hosts_orcharhino Proxy">Deploying a Custom SSL Certificate to Hosts</h5>
<div class="paragraph">
<p>After you configure orcharhino Proxy to use a custom SSL certificate, you must also install the <code>katello-ca-consumer</code> package on every host that is registered to this orcharhino Proxy.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>On each host, install the <code>katello-ca-consumer</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum localinstall \
http://<em>orcharhino Proxy.example.com</em>/pub/katello-ca-consumer-latest.noarch.rpm</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="performing-additional-configuration-on-capsule-server">3. Performing Additional Configuration on orcharhino Proxy</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use this chapter to configure additional settings on your orcharhino Proxy.</p>
</div>
<div class="sect2">
<h3 id="enabling-openscap_orcharhino Proxy">3.1. Enabling OpenSCAP on External orcharhino Proxies</h3>
<div class="paragraph">
<p>On orcharhino server and the integrated orcharhino Proxy of your orcharhino server, OpenSCAP is enabled by default.</p>
</div>
<div class="paragraph">
<p>To use the OpenSCAP plug-in and content on an external orcharhino Proxy, you must enable OpenSCAP on each orcharhino Proxy.</p>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable OpenSCAP, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># orcharhino-installer --no-enable-foreman \
--enable-foreman-proxy-plugin-openscap</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enabling-power-management-on-managed-hosts_orcharhino Proxy">3.2. Enabling Power Management on Managed Hosts</h3>
<div class="paragraph">
<p>To perform power management tasks on managed hosts using the intelligent platform management interface (IPMI) or a similar protocol, you must enable the baseboard management controller (BMC) module on orcharhino Proxy.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>All managed hosts must have a network interface of BMC type.
orcharhino Proxy uses this NIC to pass the appropriate credentials to the host.
For more information, see <a href="sources/management_ui/the_hosts_menu.html#adding-a-bmc-interface">Adding a Baseboard Management Controller (BMC) Interface</a> in <em>Managing Hosts</em>.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>To enable BMC, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># orcharhino-installer --no-enable-foreman \
--foreman-proxy-bmc "true" \
--foreman-proxy-bmc-default-provider "freeipmi"</pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="configuring-dns-dhcp-and-tftp_orcharhino Proxy">3.3. Configuring DNS, DHCP, and TFTP on orcharhino Proxy</h3>
<div class="paragraph">
<p>To configure the DNS, DHCP, and TFTP services on orcharhino Proxy, use the <code>foreman-installer</code> command with the options appropriate for your environment.
To view a complete list of configurable options, enter the <code>foreman-installer --scenario katello --help</code> command.</p>
</div>
<div class="paragraph">
<p>Any changes to the settings require entering the <code>foreman-installer</code> command again.
You can enter the command multiple times and each time it updates all configuration files with the changed values.</p>
</div>
<div class="paragraph">
<p>To use external DNS, DHCP, and TFTP services instead, see <a href="#configuring-external-services">Configuring orcharhino Proxy with External Services</a>.</p>
</div>
<div class="paragraph">
<div class="title">Adding Multihomed DHCP details</div>
<p>If you want to use Multihomed DHCP, you must inform the installer.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have the correct network name (<code>dns-interface</code>) for the DNS server.</p>
</li>
<li>
<p>You must have the correct interface name (<code>dhcp-interface</code>) for the DHCP server.</p>
</li>
<li>
<p>Contact your network administrator to ensure that you have the correct settings.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Enter the <code>foreman-installer</code> command with the options appropriate for your environment.
The following example shows configuring full provisioning services:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># orcharhino-installer --no-enable-foreman \
--foreman-proxy-dns true \
--foreman-proxy-dns-managed true \
--foreman-proxy-dns-interface <em>eth0</em> \
--foreman-proxy-dns-zone <em>example.com</em> \
--foreman-proxy-dns-reverse <em>2.0.192.in-addr.arpa</em> \
--foreman-proxy-dhcp true \
--foreman-proxy-dhcp-managed true \
--foreman-proxy-dhcp-interface <em>eth0</em> \
--foreman-proxy-dhcp-additional-interfaces <em>eth1</em> \
--foreman-proxy-dhcp-additional-interfaces <em>eth2</em> \
--foreman-proxy-dhcp-range "<em>192.0.2.100</em> <em>192.0.2.150</em>" \
--foreman-proxy-dhcp-gateway <em>192.0.2.1</em> \
--foreman-proxy-dhcp-nameservers <em>192.0.2.2</em> \
--foreman-proxy-tftp true \
--foreman-proxy-tftp-managed true \
--foreman-proxy-tftp-servername <em>192.0.2.3</em></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information about configuring DHCP, DNS, and TFTP services, see the <a href="https://docs.theforeman.org/2.4/Provisioning_Guide/index-foreman-el.html#Configuring_Networking-Configuring_Network_Services_for_PXE_Boot">Configuring Network Services</a> section in the <em>Provisioning Guide</em>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring-external-services">4. Configuring orcharhino Proxy with External Services</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you do not want to configure the DNS, DHCP, and TFTP services on orcharhino Proxy, use this section to configure your orcharhino Proxy to work with external DNS, DHCP and TFTP services.</p>
</div>
<div class="sect2">
<h3 id="configuring-external-dns_orcharhino Proxy">4.1. Configuring orcharhino Proxy with External DNS</h3>
<div class="paragraph">
<p>You can configure orcharhino Proxy with external DNS.
orcharhino Proxy uses the <code>nsupdate</code> utility to update DNS records on the remote server.</p>
</div>
<div class="paragraph">
<p>To make any changes persistent, you must enter the <code>foreman-installer</code> command with the options appropriate for your environment.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must have a configured external DNS server.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>bind-utils</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install bind bind-utils</pre>
</div>
</div>
</li>
<li>
<p>Copy the <code>/etc/rndc.key</code> file from the external DNS server to orcharhino Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp root@<em>dns.example.com</em>:/etc/rndc.key /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Configure the ownership, permissions, and SELinux context:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -v /etc/rndc.key
# chown -v root:named /etc/rndc.key
# chmod -v 640 /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>To test the <code>nsupdate</code> utility, add a host remotely:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server <em>DNS_IP_Address</em>\n \
update add aaa.virtual.lan 3600 IN A <em>Host_IP_Address</em>\n \
send\n" | nsupdate -k /etc/rndc.key
# nslookup aaa.virtual.lan <em>DNS_IP_Address</em>
# echo -e "server <em>DNS_IP_Address</em>\n \
update delete aaa.virtual.lan 3600 IN A <em>Host_IP_Address</em>\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.
Normally, foreman-installer ensures that the <code>foreman-proxy</code> user belongs to the <code>named</code> UNIX group, however, in this scenario orcharhino does not manage users and groups, therefore you need to assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># usermod -a -G named foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/dns.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dns=true \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="<em>DNS_IP_Address</em>" \
--foreman-proxy-keyfile=/etc/rndc.key \
--foreman-proxy-dns-ttl=86400</pre>
</div>
</div>
</li>
<li>
<p>Restart the foreman-proxy service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Log in to orcharhino server web UI.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino Proxies</strong>, locate the orcharhino Proxy, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Associate the DNS service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-dhcp_orcharhino Proxy">4.2. Configuring orcharhino Proxy with External DHCP</h3>
<div class="paragraph">
<p>To configure orcharhino Proxy with external DHCP, you must complete the following procedures:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="#configuring-an-external-dhcp-server_orcharhino Proxy">Configuring an External DHCP Server to Use with orcharhino Proxy</a></p>
</li>
<li>
<p><a href="#configuring-satellite-deployment-with-an-external-dhcp-server_orcharhino Proxy">Configuring orcharhino Proxy with an External DHCP Server</a></p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="configuring-an-external-dhcp-server_orcharhino Proxy">4.2.1. Configuring an External DHCP Server to Use with orcharhino Proxy</h4>
<div class="paragraph">
<p>To configure an external DHCP server to use with orcharhino Proxy, on a Red&#160;Hat Enterprise Linux server, you must install the ISC DHCP Service and Berkeley Internet Name Domain (BIND) packages.
You must also share the DHCP configuration and lease files with orcharhino Proxy.
The example in this procedure uses the distributed Network File System (NFS) protocol to share the DHCP configuration and lease files.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you use dnsmasq as an external DHCP server, enable the <code>dhcp-no-override</code> setting.
This is required because orcharhino creates configuration files on the TFTP server under the <code>grub2/</code> subdirectory.
If the <code>dhcp-no-override</code> setting is disabled, clients fetch the bootloader and its configuration from the root directory, which might cause an error.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you do not use <code>firewall-cmd</code> to configure the Linux firewall, implement using the command of your choice.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>On a Red&#160;Hat Enterprise Linux Server server, install the ISC DHCP Service and Berkeley Internet Name Domain (BIND) packages:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install dhcp bind</pre>
</div>
</div>
</li>
<li>
<p>Generate a security token:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># dnssec-keygen -a HMAC-MD5 -b 512 -n HOST omapi_key</pre>
</div>
</div>
<div class="paragraph">
<p>As a result, a key pair that consists of two files is created in the current directory.</p>
</div>
</li>
<li>
<p>Copy the secret hash from the key:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat Komapi_key.+*.private |grep ^Key|cut -d ' ' -f2</pre>
</div>
</div>
</li>
<li>
<p>Edit the <code>dhcpd</code> configuration file for all of the subnets and add the key.
The following is an example:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># cat /etc/dhcp/dhcpd.conf
default-lease-time 604800;
max-lease-time 2592000;
log-facility local7;

subnet <em>192.168.38.0</em> netmask <em>255.255.255.0</em> {
	range <em>192.168.38.10 192.168.38.100</em>;
	option routers <em>192.168.38.1</em>;
	option subnet-mask <em>255.255.255.0</em>;
	option domain-search "<em>virtual.lan</em>";
	option domain-name "<em>virtual.lan</em>";
	option domain-name-servers <em>8.8.8.8</em>;
}

omapi-port 7911;
key omapi_key {
	algorithm HMAC-MD5;
	secret "jNSE5YI3H1A8Oj/tkV4...A2ZOHb6zv315CkNAY7DMYYCj48Umw==";
};
omapi-key omapi_key;</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the <code>option routers</code> value is the orcharhino or orcharhino Proxy IP address that you want to use with an external DHCP service.</p>
</div>
</li>
<li>
<p>Delete the two key files from the directory that they were created in.</p>
</li>
<li>
<p>On orcharhino server, define each subnet.
Do not set DHCP orcharhino Proxy for the defined Subnet yet.</p>
<div class="paragraph">
<p>To prevent conflicts, set up the lease and reservation ranges separately.
For example, if the lease range is 192.168.38.10 to 192.168.38.100, in the orcharhino web UI define the reservation range as 192.168.38.101 to 192.168.38.250.</p>
</div>
</li>
<li>
<p>Configure the firewall for external access to the DHCP server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-service dhcp \
&amp;&amp; firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino server, determine the UID and GID of the <code>foreman</code> user:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># id -u foreman
<em>993</em>
# id -g foreman
<em>990</em></pre>
</div>
</div>
</li>
<li>
<p>On the DHCP server, create the <code>foreman</code> user and group with the same IDs as determined in a previous step:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># groupadd -g <em>990</em> foreman
# useradd -u <em>993</em> -g <em>990</em> -s /sbin/nologin foreman</pre>
</div>
</div>
</li>
<li>
<p>To ensure that the configuration files are accessible, restore the read and execute flags:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chmod o+rx /etc/dhcp/
# chmod o+r /etc/dhcp/dhcpd.conf
# chattr +i /etc/dhcp/ /etc/dhcp/dhcpd.conf</pre>
</div>
</div>
</li>
<li>
<p>Start the DHCP service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl start dhcpd</pre>
</div>
</div>
</li>
<li>
<p>Export the DHCP configuration and lease files using NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install nfs-utils
# systemctl enable rpcbind nfs-server
# systemctl start rpcbind nfs-server nfs-lock nfs-idmapd</pre>
</div>
</div>
</li>
<li>
<p>Create directories for the DHCP configuration and lease files that you want to export using NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /exports/var/lib/dhcpd /exports/etc/dhcp</pre>
</div>
</div>
</li>
<li>
<p>To create mount points for the created directories, add the following line to the <code>/etc/fstab</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/var/lib/dhcpd /exports/var/lib/dhcpd none bind,auto 0 0
/etc/dhcp /exports/etc/dhcp none bind,auto 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems in <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Ensure the following lines are present in <code>/etc/exports</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">/exports <em>192.168.38.1</em>(rw,async,no_root_squash,fsid=0,no_subtree_check)

/exports/etc/dhcp <em>192.168.38.1</em>(ro,async,no_root_squash,no_subtree_check,nohide)

/exports/var/lib/dhcpd <em>192.168.38.1</em>(ro,async,no_root_squash,no_subtree_check,nohide)</pre>
</div>
</div>
<div class="paragraph">
<p>Note that the IP address that you enter is the orcharhino or orcharhino Proxy IP address that you want to use with an external DHCP service.</p>
</div>
</li>
<li>
<p>Reload the NFS server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># exportfs -rva</pre>
</div>
</div>
</li>
<li>
<p>Configure the firewall for the DHCP omapi port 7911:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --add-port="7911/tcp" \
&amp;&amp; firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
<li>
<p>Optional: Configure the firewall for external access to NFS.
Clients are configured using NFSv3.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># firewall-cmd --zone public --add-service mountd \
&amp;&amp; firewall-cmd --zone public --add-service rpc-bind \
&amp;&amp; firewall-cmd --zone public --add-service nfs \
&amp;&amp; firewall-cmd --runtime-to-permanent</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-satellite-deployment-with-an-external-dhcp-server_orcharhino Proxy">4.2.2. Configuring orcharhino Proxy with an External DHCP Server</h4>
<div class="paragraph">
<p>You can configure orcharhino Proxy with an external DHCP server.</p>
</div>
<div class="ulist">
<div class="title">Prerequisite</div>
<ul>
<li>
<p>Ensure that you have configured an external DHCP server and that you have shared the DHCP configuration and lease files with orcharhino Proxy.
For more information, see <a href="#configuring-an-external-dhcp-server_orcharhino Proxy">Configuring an External DHCP Server to Use with orcharhino Proxy</a>.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Install the <code>nfs-utils</code> utility:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install nfs-utils</pre>
</div>
</div>
</li>
<li>
<p>Create the DHCP directories for NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /mnt/nfs/etc/dhcp /mnt/nfs/var/lib/dhcpd</pre>
</div>
</div>
</li>
<li>
<p>Change the file owner:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown -R foreman-proxy /mnt/nfs</pre>
</div>
</div>
</li>
<li>
<p>Verify communication with the NFS server and the Remote Procedure Call (RPC) communication paths:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># showmount -e <em>DHCP_Server_FQDN</em>
# rpcinfo -p <em>DHCP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Add the following lines to the <code>/etc/fstab</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>DHCP_Server_FQDN</em>:/exports/etc/dhcp /mnt/nfs/etc/dhcp nfs
ro,vers=3,auto,nosharecache,context="system_u:object_r:dhcp_etc_t:s0" 0 0

<em>DHCP_Server_FQDN</em>:/exports/var/lib/dhcpd /mnt/nfs/var/lib/dhcpd nfs
ro,vers=3,auto,nosharecache,context="system_u:object_r:dhcpd_state_t:s0" 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems on <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>To verify that the <code>foreman-proxy</code> user can access the files that are shared over the network, display the DHCP configuration and lease files:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># su foreman-proxy -s /bin/bash
bash-4.2$ cat /mnt/nfs/etc/dhcp/dhcpd.conf
bash-4.2$ cat /mnt/nfs/var/lib/dhcpd/dhcpd.leases
bash-4.2$ exit</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/dhcp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-dhcp=true \
--foreman-proxy-dhcp-provider=remote_isc \
--foreman-proxy-plugin-dhcp-remote-isc-dhcp-config /mnt/nfs/etc/dhcp/dhcpd.conf \
--foreman-proxy-plugin-dhcp-remote-isc-dhcp-leases /mnt/nfs/var/lib/dhcpd/dhcpd.leases \
--foreman-proxy-plugin-dhcp-remote-isc-key-name=omapi_key \
--foreman-proxy-plugin-dhcp-remote-isc-key-secret=jNSE5YI3H1A8Oj/tkV4...A2ZOHb6zv315CkNAY7DMYYCj48Umw== \
--foreman-proxy-plugin-dhcp-remote-isc-omapi-port=7911 \
--enable-foreman-proxy-plugin-dhcp-remote-isc \
--foreman-proxy-dhcp-server=<em>DHCP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Restart the <code>foreman-proxy</code> service:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>Log in to orcharhino server web UI.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino Proxies</strong>, locate the orcharhino Proxy, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Associate the DHCP service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-tftp_orcharhino Proxy">4.3. Configuring orcharhino Proxy with External TFTP</h3>
<div class="paragraph">
<p>You can configure orcharhino Proxy with external TFTP services.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the TFTP directory for NFS:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mkdir -p /mnt/nfs/var/lib/tftpboot</pre>
</div>
</div>
</li>
<li>
<p>In the <code>/etc/fstab</code> file, add the following line:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"><em>TFTP_Server_IP_Address</em>:/exports/var/lib/tftpboot /mnt/nfs/var/lib/tftpboot nfs rw,vers=3,auto,nosharecache,context="system_u:object_r:tftpdir_rw_t:s0" 0 0</pre>
</div>
</div>
</li>
<li>
<p>Mount the file systems in <code>/etc/fstab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># mount -a</pre>
</div>
</div>
</li>
<li>
<p>Enter the <code>foreman-installer</code> command to make the following persistent changes to the <code>/etc/foreman-proxy/settings.d/tftp.yml</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-tftp=true \
--foreman-proxy-tftp-root /mnt/nfs/var/lib/tftpboot</pre>
</div>
</div>
</li>
<li>
<p>If the TFTP service is running on a different server than the DHCP service, update the <code>tftp_servername</code> setting with the FQDN or IP address of the server that the TFTP service is running on:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --foreman-proxy-tftp-servername=<em>TFTP_Server_FQDN</em></pre>
</div>
</div>
</li>
<li>
<p>Log in to orcharhino server web UI.</p>
</li>
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino Proxies</strong>, locate the orcharhino Proxy, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Associate the TFTP service with the appropriate subnets and domain.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="configuring-external-idm-dns_orcharhino Proxy">4.4. Configuring orcharhino Proxy with External IdM DNS</h3>
<div class="paragraph">
<p>When orcharhino server adds a DNS record for a host, it first determines which orcharhino Proxy is providing DNS for that domain.
It then communicates with the orcharhino Proxy that is configured to provide DNS service for your deployment and adds the record.
The hosts are not involved in this process.
Therefore, you must install and configure the IdM client on the orcharhino or orcharhino Proxy that is currently configured to provide a DNS service for the domain you want to manage using the IdM server.</p>
</div>
<div class="paragraph">
<p>orcharhino Proxy can be configured to use a Red&#160;Hat Identity Management (IdM) server to provide DNS service.
For more information about Red&#160;Hat Identity Management, see the <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/">Linux Domain Identity, Authentication, and Policy Guide</a>.</p>
</div>
<div class="paragraph">
<p>To configure orcharhino Proxy to use a Red&#160;Hat Identity Management (IdM) server to provide DNS service, use one of the following procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#configuring-dynamic-dns-update-with-gss-tsig-authentication_orcharhino Proxy">Configuring Dynamic DNS Update with GSS-TSIG Authentication</a></p>
</li>
<li>
<p><a href="#configuring-dynamic-dns-update-with-tsig-authentication_orcharhino Proxy">Configuring Dynamic DNS Update with TSIG Authentication</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To revert to internal DNS service, use the following procedure:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#reverting-to-internal-dns-service_orcharhino Proxy">Reverting to Internal DNS Service</a></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You are not required to use orcharhino Proxy to manage DNS.
When you are using the realm enrollment feature of orcharhino, where provisioned hosts are enrolled automatically to IdM, the <code>ipa-client-install</code> script creates DNS records for the client.
Configuring orcharhino Proxy with external IdM DNS and realm enrollment are mutually exclusive.
For more information about configuring realm enrollment, see <a href="sources/management_ui/the_administer_menu.html#sect-Red_Hat_Satellite-Administering_Red_Hat_Satellite-Configuring_External_Authentication-External_Authentication_for_Provisioned_Hosts">External Authentication for Provisioned Hosts</a> in <em>Administering orcharhino</em>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="configuring-dynamic-dns-update-with-gss-tsig-authentication_orcharhino Proxy">4.4.1. Configuring Dynamic DNS Update with GSS-TSIG Authentication</h4>
<div class="paragraph">
<p>You can configure the IdM server to use the generic security service algorithm for secret key transaction (GSS-TSIG) technology defined in <a href="https://tools.ietf.org/html/rfc3645">RFC3645</a>.
To configure the IdM server to use the GSS-TSIG technology, you must install the IdM client on the orcharhino Proxy base operating system.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must ensure the IdM server is deployed and the host-based firewall is configured correctly.
For more information, see <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/installing-ipa.html#prereq-ports">Port Requirements</a> in the <em>Linux Domain Identity, Authentication, and Policy Guide</em>.</p>
</li>
<li>
<p>You must contact the IdM server administrator to ensure that you obtain an account on the IdM server with permissions to create zones on the IdM server.</p>
</li>
<li>
<p>You must confirm whether orcharhino server or orcharhino Proxy is configured to provide DNS service for your deployment.</p>
</li>
<li>
<p>You must configure DNS, DHCP and TFTP services on the base operating system of either the orcharhino or orcharhino Proxy that is managing the DNS service for your deployment.</p>
</li>
<li>
<p>You must create a backup of the answer file.
You can use the backup to restore the answer file to its original state if it becomes corrupted.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_installation_guide.html#configuring-server_orcharhino">Configuring orcharhino server</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure dynamic DNS update with GSS-TSIG authentication, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Creating a Kerberos Principal on the IdM Server</div>
<ol class="arabic">
<li>
<p>Obtain a Kerberos ticket for the account obtained from the IdM administrator:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit <em>idm_user</em></pre>
</div>
</div>
</li>
<li>
<p>Create a new Kerberos principal for orcharhino Proxy to use to authenticate on the IdM server.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa service-add <em>orcharhino-proxy.example.com</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Installing and Configuring the IdM Client</div>
<ol class="arabic">
<li>
<p>On the base operating system of either the orcharhino or orcharhino Proxy that is managing the DNS service for your deployment, install the <code>ipa-client</code> package:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install ipa-client</pre>
</div>
</div>
</li>
<li>
<p>Configure the IdM client by running the installation script and following the on-screen prompts:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-client-install</pre>
</div>
</div>
</li>
<li>
<p>Obtain a Kerberos ticket:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit admin</pre>
</div>
</div>
</li>
<li>
<p>Remove any preexisting <code>keytab</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># rm /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
</li>
<li>
<p>Obtain the <code>keytab</code> for this system:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># ipa-getkeytab -p orcharhino Proxy/<em>orcharhino.example.com@EXAMPLE.COM</em> \
-s <em>idm1.example.com</em> -k /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>When adding a keytab to a standby system with the same host name as the original system in service, add the <code>r</code> option to prevent generating new credentials and rendering the credentials on the original system invalid.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>For the <code>dns.keytab</code> file, set the group and owner to <code>foreman-proxy</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># chown foreman-proxy:foreman-proxy /etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
</li>
<li>
<p>Optional: To verify that the <code>keytab</code> file is valid, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># kinit -kt /etc/foreman-proxy/dns.keytab \
orcharhino Proxy/<em>orcharhino.example.com@EXAMPLE.COM</em></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring DNS Zones in the IdM web UI</div>
<ol class="arabic">
<li>
<p>Create and configure the zone that you want to manage:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.</p>
</li>
<li>
<p>Select <strong>Add</strong> and enter the zone name.
For example, <code>example.com</code>.</p>
</li>
<li>
<p>Click <strong>Add and Edit</strong>.</p>
</li>
<li>
<p>Click the Settings tab and in the <strong>BIND update policy</strong> box, add the following to the semi-colon separated list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant orcharhino Proxy/047<em>orcharhino.example.com@EXAMPLE.COM</em> wildcard * ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Enable <strong>Allow PTR sync</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create and configure the reverse zone:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.</p>
</li>
<li>
<p>Click <strong>Add</strong>.</p>
</li>
<li>
<p>Select <strong>Reverse zone IP network</strong> and add the network address in CIDR format to enable reverse lookups.</p>
</li>
<li>
<p>Click <strong>Add and Edit</strong>.</p>
</li>
<li>
<p>Click the <strong>Settings</strong> tab and in the <strong>BIND update policy</strong> box, add the following to the semi-colon separated list:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant orcharhino Proxy\047<em>orcharhino.example.com@EXAMPLE.COM</em> wildcard * ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Click <strong>Save</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring the orcharhino or orcharhino Proxy that Manages the DNS Service for the Domain</div>
<ol class="arabic">
<li>
<p>Use the <code>foreman-installer</code> command to configure the orcharhino or orcharhino Proxy that manages the DNS Service for the domain:</p>
<div class="ulist">
<ul>
<li>
<p>On orcharhino, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">foreman-installer --scenario katello \
--foreman-proxy-dns=true \
--foreman-proxy-dns-managed=true \
--foreman-proxy-dns-provider=nsupdate_gss \
--foreman-proxy-dns-server="<em>idm1.example.com</em>" \
--foreman-proxy-dns-tsig-principal="orcharhino Proxy/<em>orcharhino.example.com@EXAMPLE.COM</em>" \
--foreman-proxy-dns-tsig-keytab=/etc/foreman-proxy/dns.keytab \
--foreman-proxy-dns-reverse="55.168.192.in-addr.arpa" \
--foreman-proxy-dns-zone=<em>example.com</em> \
--foreman-proxy-dns-ttl=86400</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino Proxy, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">orcharhino-installer --no-enable-foreman \
--foreman-proxy-dns=true \
--foreman-proxy-dns-managed=true \
--foreman-proxy-dns-provider=nsupdate_gss \
--foreman-proxy-dns-server="<em>idm1.example.com</em>" \
--foreman-proxy-dns-tsig-principal="orcharhino Proxy/<em>orcharhino.example.com@EXAMPLE.COM</em>" \
--foreman-proxy-dns-tsig-keytab=/etc/foreman-proxy/dns.keytab \
--foreman-proxy-dns-reverse="55.168.192.in-addr.arpa" \
--foreman-proxy-dns-zone=<em>example.com</em> \
--foreman-proxy-dns-ttl=86400</pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Restart the orcharhino or orcharhino Proxy&#8217;s Proxy Service.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl restart foreman-proxy</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>After you run the <code>foreman-installer</code> command to make any changes to your orcharhino Proxy configuration, you must update the configuration of each affected orcharhino Proxy in the orcharhino web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Updating the Configuration in the orcharhino web UI</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino Proxies</strong>, locate the orcharhino Proxy, and from the list in the <strong>Actions</strong> column, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Configure the domain:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and select the domain name.</p>
</li>
<li>
<p>In the <strong>Domain</strong> tab, ensure <strong>DNS orcharhino Proxy</strong> is set to the orcharhino Proxy where the subnet is connected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the subnet:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select the subnet name.</p>
</li>
<li>
<p>In the <strong>Subnet</strong> tab, set <strong>IPAM</strong> to <strong>None</strong>.</p>
</li>
<li>
<p>In the <strong>Domains</strong> tab, select the domain that you want to manage using the IdM server.</p>
</li>
<li>
<p>In the <strong>orcharhino Proxies</strong> tab, ensure <strong>Reverse DNS orcharhino Proxy</strong> is set to the orcharhino Proxy where the subnet is connected.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="configuring-dynamic-dns-update-with-tsig-authentication_orcharhino Proxy">4.4.2. Configuring Dynamic DNS Update with TSIG Authentication</h4>
<div class="paragraph">
<p>You can configure an IdM server to use the secret key transaction authentication for DNS (TSIG) technology that uses the <code>rndc.key</code> key file for authentication.
The TSIG protocol is defined in <a href="https://tools.ietf.org/html/rfc2845">RFC2845</a>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must ensure the IdM server is deployed and the host-based firewall is configured correctly.
For more information, see <a href="https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/Linux_Domain_Identity_Authentication_and_Policy_Guide/installing-ipa.html#prereq-ports">Port Requirements</a> in the <em>Linux Domain Identity, Authentication, and Policy Guide</em>.</p>
</li>
<li>
<p>You must obtain <code>root</code> user access on the IdM server.</p>
</li>
<li>
<p>You must confirm whether orcharhino server or orcharhino Proxy is configured to provide DNS service for your deployment.</p>
</li>
<li>
<p>You must configure DNS, DHCP and TFTP services on the base operating system of either the orcharhino or orcharhino Proxy that is managing the DNS service for your deployment.</p>
</li>
<li>
<p>You must create a backup of the answer file.
You can use the backup to restore the answer file to its original state if it becomes corrupted.
For more information, see <a href="sources/installation_and_maintenance/orcharhino_installation_guide.html#configuring-server_orcharhino">Configuring orcharhino server</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>To configure dynamic DNS update with TSIG authentication, complete the following steps:</p>
</div>
<div class="olist arabic">
<div class="title">Enabling External Updates to the DNS Zone in the IdM Server</div>
<ol class="arabic">
<li>
<p>On the IdM Server, add the following to the top of the <code>/etc/named.conf</code> file:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">########################################################################

include "/etc/rndc.key";
controls  {
inet _IdM_Server_IP_Address_ port 953 allow { _orcharhino_IP_Address_; } keys { "rndc-key"; };
};
########################################################################</pre>
</div>
</div>
</li>
<li>
<p>Reload the <code>named</code> service to make the changes take effect:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># systemctl reload named</pre>
</div>
</div>
</li>
<li>
<p>In the IdM web UI, navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong> and click the name of the zone.
In the <strong>Settings</strong> tab, apply the following changes:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add the following in the <code>BIND update policy</code> box:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">grant "rndc-key" zonesub ANY;</pre>
</div>
</div>
</li>
<li>
<p>Set <strong>Dynamic update</strong> to <strong>True</strong>.</p>
</li>
<li>
<p>Click <strong>Update</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Copy the <code>/etc/rndc.key</code> file from the IdM server to the base operating system of your orcharhino server.
Enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># scp /etc/rndc.key root@<em>satellite.example.com</em>:/etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>To set the correct ownership, permissions, and SELinux context for the <code>rndc.key</code> file, enter the following command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># restorecon -v /etc/rndc.key
# chown -v root:named /etc/rndc.key
# chmod -v 640 /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.
Normally, foreman-installer ensures that the <code>foreman-proxy</code> user belongs to the <code>named</code> UNIX group, however, in this scenario orcharhino does not manage users and groups, therefore you need to assign the <code>foreman-proxy</code> user to the <code>named</code> group manually.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># usermod -a -G named foreman-proxy</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino server, enter the following <code>satellite-installer</code> command to configure orcharhino to use the external DNS server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer --scenario katello \
--foreman-proxy-dns=true \
--foreman-proxy-dns-managed=false \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="<em>IdM_Server_IP_Address</em>" \
--foreman-proxy-keyfile=/etc/rndc.key \
--foreman-proxy-dns-ttl=86400</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Testing External Updates to the DNS Zone in the IdM Server</div>
<ol class="arabic">
<li>
<p>Install the <code>bind-utils</code> utility:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># yum install bind-utils</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the key in the <code>/etc/rndc.key</code> file on orcharhino server is the same key file that is used on the IdM server:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap">key "rndc-key" {
        algorithm hmac-md5;
        secret "<em>secret-key</em>==";
};</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino server, create a test DNS entry for a host.
For example, host <code><em>test.example.com</em></code> with an A record of <code>192.168.25.20</code> on the IdM server at <code>192.168.25.1</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server 192.168.25.1\n \
update add <em>test.example.com</em> 3600 IN A 192.168.25.20\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>On orcharhino server, test the DNS entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># nslookup <em>test.example.com</em> 192.168.25.1
Server:		192.168.25.1
Address:	192.168.25.1#53

Name:	test.example.com
Address: 192.168.25.20</pre>
</div>
</div>
</li>
<li>
<p>To view the entry in the IdM web UI, navigate to <strong>Network Services</strong> &gt; <strong>DNS</strong> &gt; <strong>DNS Zones</strong>.
Click the name of the zone and search for the host by name.</p>
</li>
<li>
<p>If resolved successfully, remove the test DNS entry:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># echo -e "server 192.168.25.1\n \
update delete <em>test.example.com</em> 3600 IN A 192.168.25.20\n \
send\n" | nsupdate -k /etc/rndc.key</pre>
</div>
</div>
</li>
<li>
<p>Confirm that the DNS entry was removed:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># nslookup <em>test.example.com</em> 192.168.25.1</pre>
</div>
</div>
<div class="paragraph">
<p>The above <code>nslookup</code> command fails and returns the <code>SERVFAIL</code> error message if the record was successfully deleted.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="reverting-to-internal-dns-service_orcharhino Proxy">4.4.3. Reverting to Internal DNS Service</h4>
<div class="paragraph">
<p>You can revert to using orcharhino server and orcharhino Proxy as your DNS providers.
You can use a backup of the answer file that was created before configuring external DNS, or you can create a backup of the answer file.
For more information about answer files, see <a href="sources/installation_and_maintenance/orcharhino_installation_guide.html#configuring-server_orcharhino">Configuring orcharhino server</a>.</p>
</div>
<div class="paragraph">
<div class="title">Procedure</div>
<p>On the orcharhino or orcharhino Proxy that you want to configure to manage DNS service for the domain, complete the following steps:</p>
</div>
<div class="ulist">
<div class="title">Configuring orcharhino or orcharhino Proxy as a DNS Server</div>
<ul>
<li>
<p>If you have created a backup of the answer file before configuring external DNS, restore the answer file and then enter the <code>foreman-installer</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer</pre>
</div>
</div>
</li>
<li>
<p>If you do not have a suitable backup of the answer file, create a backup of the answer file now.
To configure orcharhino or orcharhino Proxy as DNS server without using an answer file, enter the following <code>foreman-installer</code> command on orcharhino and each affected orcharhino Proxy:</p>
<div class="listingblock">
<div class="content">
<pre class="nowrap"># foreman-installer \
--foreman-proxy-dns=true \
--foreman-proxy-dns-managed=true \
--foreman-proxy-dns-provider=nsupdate \
--foreman-proxy-dns-server="127.0.0.1"  \
--foreman-proxy-dns-tsig-principal="foremanproxy/<em>orcharhino.example.com@EXAMPLE.COM</em>" \
--foreman-proxy-dns-tsig-keytab=/etc/foreman-proxy/dns.keytab</pre>
</div>
</div>
<div class="paragraph">
<p>For more information,see <a href="sources/installation_and_maintenance/orcharhino_proxy_installation_guide.html#configuring-dns-dhcp-and-tftp_orcharhino Proxy">Configuring DNS, DHCP, and TFTP on orcharhino Proxy</a>.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>After you run the <code>foreman-installer</code> command to make any changes to your orcharhino Proxy configuration, you must update the configuration of each affected orcharhino Proxy in the orcharhino web UI.</p>
</div>
<div class="olist arabic">
<div class="title">Updating the Configuration in the orcharhino web UI</div>
<ol class="arabic">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>orcharhino Proxies</strong>.</p>
</li>
<li>
<p>For each orcharhino Proxy that you want to update, from the <strong>Actions</strong> list, select <strong>Refresh</strong>.</p>
</li>
<li>
<p>Configure the domain:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Domains</strong> and click the domain name that you want to configure.</p>
</li>
<li>
<p>In the <strong>Domain</strong> tab, set <strong>DNS orcharhino Proxy</strong> to the orcharhino Proxy where the subnet is connected.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Configure the subnet:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Navigate to <strong>Infrastructure</strong> &gt; <strong>Subnets</strong> and select the subnet name.</p>
</li>
<li>
<p>In the <strong>Subnet</strong> tab, set <strong>IPAM</strong> to <strong>DHCP</strong> or <strong>Internal DB</strong>.</p>
</li>
<li>
<p>In the <strong>Domains</strong> tab, select the domain that you want to manage using orcharhino or orcharhino Proxy.</p>
</li>
<li>
<p>In the <strong>orcharhino Proxies</strong> tab, set <strong>Reverse DNS orcharhino Proxy</strong> to the orcharhino Proxy where the subnet is connected.</p>
</li>
<li>
<p>Click <strong>Submit</strong> to save the changes.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="capsule-server-scalability-considerations_orcharhino Proxy">Appendix A: orcharhino Proxy Scalability Considerations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The maximum number of orcharhino Proxys that orcharhino server can support has no fixed limit.
The tested limit is 17 orcharhino Proxys with 2 vCPUs on a orcharhino server with Red Hat Enterprise Linux 7.
However, scalability is highly variable, especially when managing Puppet clients.</p>
</div>
<div class="paragraph">
<p>orcharhino Proxy scalability when managing Puppet clients depends on the number of CPUs, the run-interval distribution, and the number of Puppet managed resources.
orcharhino Proxy has a limitation of 100 concurrent Puppet agents running at any single point in time.
Running more than 100 concurrent Puppet agents results in a 503 HTTP error.</p>
</div>
<div class="paragraph">
<p>For example, assuming that Puppet agent runs are evenly distributed with less than 100 concurrent Puppet agents running at any single point during a run-interval, a orcharhino Proxy with 4 CPUs has a maximum of 1250-1600 Puppet clients with a moderate workload of 10 Puppet classes assigned to each Puppet client.
Depending on the number of Puppet clients required, the orcharhino installation can scale out the number of orcharhino Proxys to support them.</p>
</div>
<div class="paragraph">
<p>If you want to scale your orcharhino Proxy when managing Puppet clients, the following assumptions are made:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>There are no external Puppet clients reporting directly to the orcharhino integrated orcharhino Proxy.</p>
</li>
<li>
<p>All other Puppet clients report directly to an external orcharhino Proxy.</p>
</li>
<li>
<p>There is an evenly distributed run-interval of all Puppet agents.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Deviating from the even distribution increases the risk of filling the passenger request queue.
The limit of 100 concurrent requests applies.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The following table describes the scalability limits using the recommended 4 CPUs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Puppet Scalability Using 4 CPUs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Puppet Managed Resources per Host</th>
<th class="tableblock halign-left valign-top">Run-Interval Distribution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3000-2500</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2400-2000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700-1400</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table describes the scalability limits using the minimum 2 CPUs.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Puppet Scalability Using 2 CPUs</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Puppet Managed Resources per Host</th>
<th class="tableblock halign-left valign-top">Run-Interval Distribution</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1700-1450</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1500-1250</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">850-700</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated Mar 2022
</div>
</div>
</body>
</html>